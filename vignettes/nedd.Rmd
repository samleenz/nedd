---
title: "nedd"
author: "Sam Lee"
date:  "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{nedd}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

set.seed(19384)
```

Welcome to our package, take a seat. Let me show you around. The purpose of this document is to give an overview of how to use the functions contained within `nedd` and also to highlight which other packages and functions we commonly use for our network analysis.

## Using `nedd`

```{r setup}
library(nedd)
library(tidyverse)
library(igraph)
```


### Protein interatction networks

Central to our network analysis methods are the protein protein interaction networks that provide us relation data about proteins. We've implemented three unweighted human PPI networks as `igraph` network objects. Node consitute proteins labelled with Uniprot IDs and edges are interactions between the proteins. 

```{r}
nedd::ascher_graph

nedd::huri_graph

nedd::STRING_graph
```

View the help pages of each of these for more details

## Other packages

Here be other packages and functions we may commonly want to use.

### Mapping between feature identifiers

The most consistent method I've found for mapping between feature identifiers is the `gprofiler2` package, which is part of the ELIXR infrastructure at EMBL. The webserver can be accessed at https://biit.cs.ut.ee/gprofiler/gost

ENSG ID to UNIPROT ID

```{r}
ensg <- c(
  "ENSG00000127080", "ENSG00000149930", "ENSG00000156711", "ENSG00000170464"
  )

uniprot <- gprofiler2::gconvert(ensg, target = "UNIPROTSWISSPROT") %>%
  dplyr::arrange(input_number)

uniprot

```

Sometines there is not a one to one mapping between naming standards. In this case the best option is to sort by `input_number`, then filter the table so there is one output per input number using `dplyr::distinct(input_number, .keep_all = TRUE)`. A `dplyr::{left,right}_join()` can then be used to drop entries in the input table that did not have a match in the target namespace. When converting from gene to protein mappings this will often occur for non-protein coding genes (rRNA, lncRNA, miRNA, pseudo-genes).

### Basic network analysis

`igraph` is the standard `R` library for analysis of network objects. The majority of straightforward analyses can be compelted with functions in this pacakge and it offers pretty powerful visualisations. The function names can be somewhat cryptic so this site is an invaluable resource https://igraph.org/r/doc/

```{r}


# create a random graph with 20 nodes, and P(edge) = 0.15
g <- sample_gnp(20, 0.15)
V(g)$name <- LETTERS[1:20]

g

plot(g)
```

#### Vertex analysis

```{r}
igraph:::V(g)

# subset a vertex sequence
igraph:::V(g)[c("C", "A", "T")]
```

#### Edge analysis

```{r}

```


#### Graph analysis

```{r}

```

#### Graph visualisation

See https://igraph.org/r/doc/plot.common.html for a comprehensive list of `igraph` plotting parameters.

```{r}

# set vertex colour reflect node betweenness
vert_col <- nedd::makeContCol(g, nStatFunc = betweenness)

# set vertex size to reflect node degree
vert_size <- degree(g) %>%
  scales::rescale(to =  c(5, 15))



plot(
  g,
  vertex.color = vert_col,
  vertex.size = vert_size,
  vertex.label.color = "grey",
  vertex.label.family = "sans",
  edge.color = "purple",
  asp = 0 # changes the aspect ratio? i find 0 to almost always improve appearance
)

```

### Heat diffusion over a graph

`diffuStats` is a package for running heat diffusion and random walks on `igraph` networks

```{r}

# create a vector of scores to diffuse over our nodes
# sample from Bernoulli dist with P(success) = 0.25
scores <- matrix(
  rbinom(20, 1, 0.25),
  dimnames = list(LETTERS[1:20], "score"),
  ncol = 1
  )

l <- layout_nicely(g)

plot(g,
     vertex.size = ifelse(scores == 1, 10, 5),
     vertex.color = diffuStats::scores2colours(scores),
     vertex.label = scores,
     asp = 0,
     layout = l
     )

diffused <- diffuStats::diffuse(
  graph = g,
  method = "ber_p",
  scores = scores
  )

plot(g,
     vertex.size = ifelse(scores == 1, 10, 5),
     vertex.color = diffuStats::scores2colours(diffused),
     vertex.label = scores,
     asp = 0,
     layout = l
     )

```
